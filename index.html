<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习越南语请联系Wx:XiDeYueNanYu</title>
    <style>
        body {
            background-color: #f7fbf3;
            margin-bottom: 60px;
        }
        #infoBox { 
            width: 100%; 
            max-width: 700px;
            height: 100px; 
            margin: 0 auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 100%; 
            max-width: 700px;
            height: 45px; 
            margin: 0px auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(12px, 2vw, 15px); 
            font-weight: bold;
        }
        .image-frame {
            max-width: 700px;
            margin: 20px auto 0 auto;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
            overflow: hidden;
        }
        .image-frame img {
            width: 100%;
            height: auto;
            display: block;
        }
        .content-box {
            max-width: 700px;
            margin: 20px auto;
            padding: 50px;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 30px;
            font-family: Arial;
            color: #222322;
            line-height: 3;
            text-align: justify;
        }
        .translated-word {
            position: relative;
            display: inline-block;
            white-space: nowrap;
            line-height: 1.3;
            background-color: #bfcdbf;
            color: #000000;
            padding: 4px 4px;
            border-radius: 2px;
        }
        .translation {
            position: absolute;
            top: -29px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            background-color: #eddabc;
            color: #313a2d;
            padding: 4px 4px;
            border-radius: 1px;
            white-space: nowrap;
            z-index: 1;
            line-height: 1;
        }
        .original {
            display: inline;
            line-height: 1;
        }
        .floating-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: block;
            z-index: 1000;
        }
        #audioPlayer {
            width: 100%;
            margin-bottom: 10px;
        }
        .time-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .time-box-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .floating-controls p#timeDisplay {
            font-size: 28px;
            color: #FFFFFF;
            background-color: #000000;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0;
        }
        .floating-controls .time-box {
            font-size: 16px;
            color: #FFFFFF;
            background-color: #555555;
            padding: 5px 10px;
            border-radius: 5px;
            min-width: 60px;
        }
        .tua-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .control-button {
            width: 50px;
            height: 50px;
            background-color: #363535;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }
        .control-button:disabled {
            background-color: #888888;
            cursor: not-allowed;
        }
        .control-button:hover:not(:disabled) {
            background-color: #000000;
        }
        .pause-play-button {
            background-color: #FF4500;
        }
        .pause-play-button:hover {
            background-color: #CC3700;
        }
        .toggle-button {
            background-color: #4682B4;
        }
        .toggle-button:hover {
            background-color: #ffffff;
        }
        .loop-button {
            background-color: #3c923c;
        }
        .loop-button:hover {
            background-color: #347d34;
        }
        .clear-button {
            background-color: #bc3f13;
        }
        .clear-button:hover {
            background-color: #d15124;
        }
        .toggle-translation-button {
            background-color: #6A5ACD;
        }
        .toggle-translation-button:hover {
            background-color: #ffffff;
        }
        .active {
            background-color: #ffffff; 
            border-radius: 5px;
        }
        @media (max-width: 400px) {
            .control-button {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            .floating-controls p#timeDisplay {
                font-size: 20px;
            }
            .floating-controls .time-box {
                font-size: 12px;
                min-width: 50px;
            }
        }
        #quizContainer {
            display: none;
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            color: #53686f;
            font-size: 25px;
            font-weight: bold;
        }
        .question {
            margin-bottom: 20px;
            padding: 18px;
            color: #53686f;
            border: 5px solid #53686f;
            border-radius: 10px;
            background-color: #ffffff;
            font-size: 20px;
            font-weight: bold;
        }
        .options label {
            display: block;
            margin: 15px 0;
            cursor: pointer;
            color: #21292c;
            font-size: 16px;
            font-weight: bold;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            display: none;
            border: 5px solid #53686f;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            background-color: #ffffff;
            color: #007a33;
        }
        .wrong-answer {
            color: #f65936;
            margin: 10px 0;
            font-size: 16px;
            font-weight: bold;
        }
        #submitQuiz {
            font-family: Arial, sans-serif;
            padding: 10px 20px;
            border: 3px solid #53686f;
            background-color: #FF6820;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        #submitQuiz:hover {
            background-color: #ff844a;
        }
        .floating-mode-bar {
            position: fixed;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #68838B;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0px 5px rgba(0, 0, 0, 1);
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1000;
            width: 900px;
        }
        .mode-button {
            padding: 10px 20px;
            border: 0px solid #ccc;
            background: #95a8ad;
            color: #293437;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        .mode-button.active {
            border: 2px solid #ffffff;
            background: #f0f0f0;
            color: #293437;
        }
        /* Mobile styles */
        @media (max-width: 768px) { 
            body {
                background-color: #f7fbf3;
                margin-bottom: 60px;
            }
            #infoBox { 
                width: 90%; 
                height: 120px; 
                margin: 0 auto; 
                border: 1px solid #ccc; 
                background: #68838B; 
                color: #D2B48C; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                font-size: 60px; 
                font-weight: bold;
            }
            #contactBox { 
                width: 90%; 
                height: 50px; 
                margin: 0px auto; 
                border: 1px solid #ccc; 
                background: #68838B; 
                color: #D2B48C; 
                display: flex; 
                align-items: center; 
                justify-content: left; 
                padding-left: 20px;
                font-size: 20px; 
                font-weight: bold;
            }
            .image-frame {
                width: 90%;
                max-width: 700px;
                margin: 10 screen auto 0 auto;
                border: 10px solid #957652;
                border-radius: 10px;
                background-color: #ffffff;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                display: none;
                overflow: hidden;
            }
            .image-frame img {
                width: 100%;
                height: auto;
                display: block;
            }
            .content-box {
                max-width: 700px;
                margin: 10px auto;
                padding: 20px;
                padding-top: 50px;
                padding-bottom: 90px;
                border: 10px solid #957652;
                border-radius: 10px;
                background-color: #ffffff;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                font-size: 19px;
                font-family: Arial;
                color: #222322;
                line-height: 3.5;
                text-align: justify;
            }
            .translated-word {
                position: relative;
                display: inline-block;
                white-space: nowrap;
                line-height: 1.3;
                background-color: #bfcdbf;
                color: #000000;
                padding: 3px 3px;
                border-radius: 2px;
            }
            .translation {
                position: absolute;
                top: -25px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 13px;
                background-color: #eddabc;
                color: #313a2d;
                padding: 4px 4px;
                border-radius: 1px;
                white-space: nowrap;
                z-index: 1;
                line-height: 1;
            }
            .original {
                display: inline;
                line-height: 1;
            }
            .floating-controls {
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #f0f0f0;
                padding: 10px;
                border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                text-align: center;
                display: block;
                z-index: 1000;
            }
            #audioPlayer {
                width: 100%;
                margin-bottom: 10px;
            }
            .time-row {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                margin-bottom: 10px;
            }
            .time-box-group {
                display: flex;
                justify-content: center;
                gap: 10px;
            }
            .button-group {
                display: flex;
                justify-content: center;
                gap: 10px;
            }
            .floating-controls p#timeDisplay {
                font-size: 28px;
                color: #FFFFFF;
                background-color: #000000;
                padding: 5px 10px;
                border-radius: 5px;
                cursor: pointer;
                margin: 0;
            }
            .floating-controls .time-box {
                font-size: 16px;
                color: #FFFFFF;
                background-color: #555555;
                padding: 5px 10px;
                border-radius: 5px;
                min-width: 60px;
            }
            .tua-buttons {
                display: flex;
                justify-content: center;
                gap: 5px;
                margin-bottom: 10px;
                flex-wrap: wrap;
            }
            .action-buttons {
                display: flex;
                justify-content: center;
                gap: 10px;
            }
            .control-button {
                width: 50px;
                height: 50px;
                background-color: #363535;
                color: white;
                border: none;
                border-radius: 50%;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                display: inline-flex;
                justify-content: center;
                align-items: center;
            }
            .control-button:disabled {
                background-color: #888888;
                cursor: not-allowed;
            }
            .control-button:hover:not(:disabled) {
                background-color: #000000;
            }
            .pause-play-button {
                background-color: #FF4500;
            }
            .pause-play-button:hover {
                background-color: #CC3700;
            }
            .toggle-button {
                background-color: #4682B4;
            }
            .toggle-button:hover {
                background-color: #36648B;
            }
            .loop-button {
                background-color: #3c923c;
            }
            .loop-button:hover {
                background-color: #347d34;
            }
            .clear-button {
                background-color: #bc3f13;
            }
            .clear-button:hover {
                background-color: #d15124;
            }
            .toggle-translation-button {
                background-color: #6A5ACD;
            }
            .toggle-translation-button:hover {
                background-color: #ffffff;
            }
            .active {
                background-color: #ffffff; 
                border-radius: 5px;
            }
            @media (max-width: 400px) {
                .control-button {
                    width: 40px;
                    height: 40px;
                    font-size: 14px;
                }
                .floating-controls p#timeDisplay {
                    font-size: 20px;
                }
                .floating-controls .time-box {
                    font-size: 12px;
                    min-width: 50px;
                }
            }
            #quizContainer {
                display: none;
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 20px auto;
                padding: 20px;
                color: #53686f;
                font-size: 25px;
                font-weight: bold;
            }
            .question {
                margin-bottom: 20px;
                padding: 18px;
                color: #53686f;
                border: 5px solid #53686f;
                border-radius: 10px;
                background-color: #ffffff;
                font-size: 16px;
                font-weight: bold;
            }
            .options label {
                display: block;
                margin: 15px 0;
                cursor: pointer;
                color: #21292c;
                font-size: 16px;
                font-weight: bold;
            }
            #result {
                margin-top: 20px;
                padding: 10px;
                display: none;
                border: 5px solid #53686f;
                border-radius: 5px;
                font-size: 16px;
                font-weight: bold;
                background-color: #ffffff;
                color: #007a33;
            }
            .wrong-answer {
                color: #f65936;
                margin: 10px 0;
                font-size: 16px;
                font-weight: bold;
            }
            #submitQuiz {
                font-family: Arial, sans-serif;
                padding: 10px 20px;
                border: 3px solid #53686f;
                background-color: #FF6820;
                border-radius: 5px;
                color: white;
                cursor: pointer;
                font-size: 18px;
                font-weight: bold;
            }
            #submitQuiz:hover {
                background-color: #ff844a;
            }
            .floating-mode-bar {
                position: fixed;
                bottom: 0px;
                left: 50%;
                transform: translateX(-50%);
                background-color: #68838B;
                padding: 10px;
                border-radius: 5px;
                box-shadow: 0 0px 5px rgba(0, 0, 0, 1);
                display: flex;
                justify-content: center;
                gap: 20px;
                z-index: 1000;
                width: 100%;
            }
            .mode-button {
                padding: 10px 20px;
                border: 0px solid #ccc;
                background: #95a8ad;
                color: #293437;
                font-size: 20px;
                font-weight: bold;
                cursor: pointer;
                border-radius: 5px;
                transition: border-color 0.3s;
            }
            .mode-button.active {
                border: 2px solid #ffffff;
                background: #f0f0f0;
                color: #293437;
            }
        }
    </style>
</head>
<body>
    <div id="infoBox">习得越南语</div>
    <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
    <div id="contentContainer">
        <div class="image-frame" id="imageFrame">
            <img id="contentImage" src="" alt="Content Image">
        </div>
        <div class="content-box" id="content"></div>
    </div>
    <div id="quizContainer">
        <h1>回答下面问题</h1>
        <form id="quizForm">
            <div id="questions"></div>
            <button type="button" id="submitQuiz" onclick="checkAnswers()">提交</button>
        </form>
        <div id="result"></div>
    </div>
    <div class="floating-controls" id="floatingControls">
        <audio id="audioPlayer" src="lesson.mp3" controls></audio>
        <div class="time-row">
            <p id="timeDisplay">00:00</p>
            <div class="time-box-group">
                <span class="time-box" id="loopStart">--:--</span>
                <span class="time-box" id="loopEnd">--:--</span>
            </div>
            <div class="button-group">
                <button class="control-button loop-button" id="loopButton">听</button>
                <button class="control-button clear-button" id="clearButton">删</button>
            </div>
        </div>
        <div class="tua-buttons">
            <button class="control-button" id="rewind5sButton">-5s</button>
            <button class="control-button" id="rewind1sButton">-1s</button>
            <button class="control-button" id="forward1sButton">+1s</button>
            <button class="control-button" id="forward5sButton">+5s</button>
        </div>
        <div class="action-buttons">
            <button class="control-button pause-play-button" id="pausePlayButton">播</button>
            <button class="control-button toggle-button" id="toggleControlsButton">藏</button>
        </div>
    </div>
    <div class="floating-mode-bar">
        <button class="mode-button toggle-translation-button" id="toggleTranslationButton">藏</button>
        <button class="mode-button active" id="contentMode">内容</button>
        <button class="mode-button" id="quizMode">回答问题</button>
    </div>

    <script>

const textContentData = [
    `Tuần trước, tôi đã có cơ hội đi du lịch Đà Lạt cùng bạn bè. Đây là một chuyến đi thú vị và đáng nhớ. Đà Lạt là một thành phố nổi tiếng với khí hậu mát mẻ quanh năm, nhiều loài hoa đẹp và ẩm thực đặc sắc. Đây là lần đầu tiên tôi đến Đà Lạt, nên tôi rất háo hức và mong chờ khám phá nơi này.

Trong chuyến đi, tôi đã chụp rất nhiều ảnh để lưu lại những kỷ niệm đẹp. Chúng tôi đã tham quan nhiều địa điểm nổi tiếng như Hồ Xuân Hương, Thung Lũng Tình Yêu và chợ đêm Đà Lạt. Mỗi nơi đều có vẻ đẹp riêng và mang đến cho tôi những trải nghiệm mới mẻ.

Khi đi dạo quanh chợ đêm, tôi nghĩ đến gia đình ở nhà. Tôi muốn mua một số món quà nhỏ để tặng bố mẹ và em gái, những người luôn yêu thương và ủng hộ tôi. Tôi bắt đầu tìm kiếm những món quà ý nghĩa và phù hợp với từng người trong gia đình.

Đầu tiên, cho bố, tôi quyết định mua một gói cà phê đặc sản của Đà Lạt. Bố tôi có thói quen uống cà phê mỗi sáng, nên tôi nghĩ đây sẽ là một món quà hợp lý và thiết thực. Tôi chọn loại cà phê nguyên chất, có hương thơm đậm đà và được đóng gói đẹp mắt.

Tiếp theo, cho mẹ, tôi chọn một chiếc khăn len màu tím nhạt. Ở chợ có rất nhiều khăn len do người dân địa phương tự tay đan. Chiếc khăn tôi chọn rất mềm mại, ấm áp và rất hợp với mẹ tôi, người thích mặc áo dài và những màu sắc nhẹ nhàng.

Cuối cùng, em gái tôi rất thích những món đồ lưu niệm dễ thương. Tôi mua cho em một con gấu bông nhỏ, mặc áo len có dòng chữ “I love Đà Lạt”. Ngoài ra, tôi còn mua thêm một ít mứt dâu và hoa khô để cả gia đình cùng thưởng thức sau bữa cơm tối.

Sau chuyến đi, tôi cảm thấy rất vui và hài lòng không chỉ vì có những kỷ niệm đẹp mà còn vì đã chuẩn bị được những món quà ý nghĩa cho từng người thân. Khi tôi về đến nhà và tặng quà cho mọi người, ai cũng bất ngờ và hạnh phúc. Mẹ tôi ngay lập tức quàng chiếc khăn mới, bố thì pha cà phê để thưởng thức, còn em gái tôi ôm gấu bông cả buổi tối.

Chuyến đi đã giúp tôi nhận ra rằng đi chơi xa không chỉ là để thư giãn mà còn là dịp để nghĩ đến những người thân yêu. Mỗi món quà, dù nhỏ, cũng là cách để bày tỏ tình cảm và sự quan tâm của mình đối với gia đình. Những kỷ niệm và món quà đó sẽ mãi là dấu ấn đặc biệt trong lòng tôi.`
];

const dictionary = {
"cơ hội": "机会",
"du lịch": "旅游",
"Đà Lạt": "大叻",
"bạn bè": "朋友",
"Đây": "这里",
"chuyến đi": "旅行",
"thú vị": "有趣",
"đáng nhớ": "难忘",
"thành phố": "城市",
"nổi tiếng": "著名",
"khí hậu": "气候",
"mát mẻ": "凉爽",
"quanh năm": "全年",
"loài hoa": "花卉",
"đẹp": "美丽",
"ẩm thực": "美食",
"đặc sắc": "独特",
"lần đầu tiên": "第一次",
"háo hức": "兴奋",
"mong chờ": "期待",
"khám phá": "探索",
"nơi này": "这个地方", "đi": "去",
"chụp": "拍摄",
"ảnh": "照片",
"lưu": "保存",
"kỷ niệm": "回忆",
"đẹp": "美丽",
"tham quan": "参观",
"địa điểm": "地点",
"nổi tiếng": "著名",
"Hồ Xuân Hương": "春香湖",
"Thung Lũng Tình Yêu": "爱情谷",
"chợ đêm": "夜市",
"Đà Lạt": "大叻",
"nơi": "地方",
"vẻ đẹp": "美丽",
"riêng": "独特,自己的",
"mang đến": "带来",
"trải nghiệm": "体验",
"mới mẻ": "新鲜", "chợ": "市场",
"đêm": "夜晚",
"gia đình": "家庭",
"món quà": "礼物",
"bố mẹ": "父母",
"em gái": "妹妹",
"yêu thương": "疼爱",
"ủng hộ": "支持",
"tìm kiếm": "寻找",
"ý nghĩa": "有意义",
"phù hợp": "适合", "bố": "爸爸",
"gói": "包",
"cà phê": "咖啡",
"đặc sản": "特产",
"Đà Lạt": "大叻",
"thói quen": "习惯",
"uống": "喝",
"sáng": "早上",
"món quà": "礼物",
"hợp lý": "合理",
"thiết thực": "实用",
"loại": "种类",
"nguyên chất": "纯正",
"hương thơm": "香味",
"đậm đà": "浓郁",
"đóng gói": "包装",
"đẹp mắt": "美观", "mẹ": "妈妈",
"khăn len": "毛线围巾",
"tím nhạt": "浅紫色",
"chợ": "市场",
"người dân": "居民",
"địa phương": "当地",
"đan": "编织",
"khăn": "围巾",
"mềm mại": "柔软",
"ấm áp": "温暖",
"hợp": "合适",
"mặc": "穿",
"áo dài": "长衫",
"màu sắc": "颜色",
"nhẹ nhàng": "柔和", "em gái": "妹妹",
"lưu niệm": "纪念品",
"dễ thương": "可爱",
"gấu bông": "毛绒熊",
"áo len": "毛衣",
"Đà Lạt": "大叻",
"mứt dâu": "草莓酱",
"hoa khô": "干花",
"gia đình": "家庭",
"thưởng thức": "品尝",
"bữa cơm": "晚餐",
"tối": "晚上", "chuyến đi": "旅行",
"vui": "开心",
"hài lòng": "满意",
"kỷ niệm": "回忆",
"đẹp": "美丽",
"chuẩn bị": "准备",
"món quà": "礼物",
"ý nghĩa": "有意义",
"người thân": "亲人",
"nhà": "家",
"tặng quà": "送礼",
"bất ngờ": "惊讶",
"hạnh phúc": "幸福",
"Mẹ": "妈妈",
"quàng": "围",
"khăn": "围巾",
"bố": "爸爸",
"pha": "泡",
"cà phê": "咖啡",
"thưởng thức": "享受",
"em gái": "妹妹",
"ôm": "抱",
"gấu bông": "毛绒熊",
"buổi tối": "晚上", "đi": "去",
"nhận ra": "意识到",
"đi chơi": "出去玩",
"thư giãn": "放松",
"dịp": "机会",
"nghĩ đến": "想到",
"người thân yêu": "亲人",
"món quà": "礼物",
"nhỏ": "小",
"cách": "方式",
"bày tỏ": "表达",
"tình cảm": "感情",
"sự quan tâm": "关心",
"gia đình": "家庭",
"kỷ niệm": "回忆",
"dấu ấn": "印记",
"đặc biệt": "特别",
"lòng": "心"
};

const quizData = [
    {
        question: "Theo đoạn trích, Đà Lạt nổi tiếng với điều gì?",
        options: ["Khí hậu nóng bức", "Nhiều loài hoa đẹp", "Ẩm thực không đa dạng", "Khí hậu khô hanh"],
        correct: "Nhiều loài hoa đẹp"
    },
    {
        question: "Trong bốn câu sau đây, câu nào là câu sai ngữ pháp?",
        options: ["Đà Lạt là một thành phố nổi tiếng với khí hậu mát mẻ quanh năm.", "Tôi đã có cơ hội đi du lịch Đà Lạt cùng bạn bè tuần trước.", "Đà Lạt có nhiều loài hoa đẹp và ẩm thực đặc sắc.", "Tôi đã có cơ hội đi du lịch Đà Lạt tuần trước cùng bạn bè."],
        correct: "Tôi đã có cơ hội đi du lịch Đà Lạt tuần trước cùng bạn bè."
    },
    {
        question: "Theo đoạn trích, người viết đã tham quan những địa điểm nào?",
        options: ["Hồ Xuân Hương, Thung Lũng Tình Yêu, chợ đêm Đà Lạt", "Hồ Xuân Hương, Thung Lũng Tình Yêu, Thác Prenn", "Thung Lũng Tình Yêu, chợ đêm Đà Lạt, Thác Prenn", "Hồ Xuân Hương, Thác Prenn, chợ đêm Đà Lạt"],
        correct: "Hồ Xuân Hương, Thung Lũng Tình Yêu, chợ đêm Đà Lạt"
    },
    {
        question: "Theo đoạn trích, người viết đã mua món quà gì cho bố?",
        options: ["Khăn len màu tím nhạt", "Gói cà phê đặc sản", "Con gấu bông nhỏ", "Mứt dâu"],
        correct: "Gói cà phê đặc sản"
    },
    {
        question: "Theo đoạn trích, người viết đã mua món quà gì cho mẹ?",
        options: ["Khăn len màu tím nhạt", "Gói cà phê đặc sản", "Con gấu bông nhỏ", "Mứt dâu"],
        correct: "Khăn len màu tím nhạt"
    },
    {
        question: "Theo đoạn trích, người viết đã mua món quà gì cho em gái?",
        options: ["Khăn len màu tím nhạt", "Gói cà phê đặc sản", "Con gấu bông nhỏ", "Mứt dâu"],
        correct: "Con gấu bông nhỏ"
    },
    {
        question: "Theo đoạn trích, người viết cảm thấy thế nào sau chuyến đi?",
        options: ["Buồn và thất vọng", "Vui và hài lòng", "Lo lắng và căng thẳng", "Mệt mỏi và chán nản"],
        correct: "Vui và hài lòng"
    },
    {
        question: "Theo đoạn trích, mẹ của người viết đã làm gì khi nhận được món quà?",
        options: ["Quàng chiếc khăn mới", "Pha cà phê để thưởng thức", "Ôm gấu bông cả buổi tối", "Thưởng thức mứt dâu"],
        correct: "Quàng chiếc khăn mới"
    },
    {
        question: "Theo đoạn trích, bố của người viết đã làm gì khi nhận được món quà?",
        options: ["Quàng chiếc khăn mới", "Pha cà phê để thưởng thức", "Ôm gấu bông cả buổi tối", "Thưởng thức mứt dâu"],
        correct: "Pha cà phê để thưởng thức"
    },
    {
        question: "Theo đoạn trích, em gái của người viết đã làm gì khi nhận được món quà?",
        options: ["Quàng chiếc khăn mới", "Pha cà phê để thưởng thức", "Ôm gấu bông cả buổi tối", "Thưởng thức mứt dâu"],
        correct: "Ôm gấu bông cả buổi tối"
    },
    {
        question: "Theo đoạn trích, người viết đã mua thêm gì để cả gia đình cùng thưởng thức sau bữa cơm tối?",
        options: ["Khăn len", "Cà phê đặc sản", "Mứt dâu và hoa khô", "Gấu bông"],
        correct: "Mứt dâu và hoa khô"
    },
    {
        question: "Theo đoạn trích, chuyến đi Đà Lạt đã giúp người viết nhận ra điều gì?",
        options: ["Đi chơi xa chỉ là để thư giãn", "Đi chơi xa là dịp để nghĩ đến những người thân yêu", "Mỗi món quà đều không có ý nghĩa", "Những kỷ niệm không quan trọng"],
        correct: "Đi chơi xa là dịp để nghĩ đến những người thân yêu"
    }
];

        // Xử lý hiển thị văn bản với từ điển
        const content = document.getElementById('content');
        let showTranslation = false; // Default to hide translations

        function renderText() {
            let html = textContentData[0].replace(/\n/g, "<br>");
            if (showTranslation) {
                const sortedKeys = Object.keys(dictionary).sort((a, b) => b.length - a.length);
                const replacements = [];

                // Bước 1: Tìm và lưu trữ các cụm từ khớp
                sortedKeys.forEach(key => {
                    const regex = new RegExp(`(\\b|[.,!?\\n\\s]|^)(${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})(\\b|[.,!?\\n\\s]|$)`, 'gi');
                    let match;
                    while ((match = regex.exec(html)) !== null) {
                        const start = match.index + match[1].length;
                        const end = start + match[2].length;
                        replacements.push({
                            start,
                            end,
                            original: match[2],
                            prefix: match[1],
                            suffix: match[3],
                            translation: dictionary[key]
                        });
                    }
                });

                // Bước 2: Sắp xếp các lần khớp theo vị trí bắt đầu (start)
                replacements.sort((a, b) => a.start - b.start);

                // Bước 3: Lọc các lần khớp để loại bỏ chồng lấn
                const filteredReplacements = [];
                let lastEnd = -1;
                for (const replacement of replacements) {
                    if (replacement.start >= lastEnd) {
                        filteredReplacements.push(replacement);
                        lastEnd = replacement.end;
                    }
                }

                // Bước 4: Thay thế các cụm từ đã khớp, từ phải sang trái để tránh ảnh hưởng chỉ số
                for (let i = filteredReplacements.length - 1; i >= 0; i--) {
                    const { start, end, original, prefix, suffix, translation } = filteredReplacements[i];
                    const translatedHtml = `${prefix}<span class="translated-word"><span class="translation">${translation}</span><span class="original">${original}</span></span>${suffix}`;
                    html = html.slice(0, start - prefix.length) + translatedHtml + html.slice(end + suffix.length);
                }
            }
            content.innerHTML = html;
        }

        // Xử lý hiển thị ảnh
        const imageFrame = document.getElementById('imageFrame');
        const contentImage = document.getElementById('contentImage');
        const imageSrc = "anhminhhoa.png"; // Tên file ảnh cụ thể trong cùng thư mục
        function renderImage() {
            if (imageSrc) {
                contentImage.src = imageSrc;
                imageFrame.style.display = 'block';
            } else {
                imageFrame.style.display = 'none';
            }
        }

        // Gọi hàm renderText và renderImage khi khởi tạo
        renderText();
        renderImage();

        // Xử lý audio và bảng điều khiển
        const audioPlayer = document.getElementById("audioPlayer");
        const floatingControls = document.getElementById("floatingControls");
        const timeDisplay = floatingControls.querySelector("#timeDisplay");
        const loopStart = floatingControls.querySelector("#loopStart");
        const loopEnd = floatingControls.querySelector("#loopEnd");
        const loopButton = floatingControls.querySelector("#loopButton");
        const clearButton = floatingControls.querySelector("#clearButton");
        const rewind5sButton = floatingControls.querySelector("#rewind5sButton");
        const rewind1sButton = floatingControls.querySelector("#rewind1sButton");
        const forward1sButton = floatingControls.querySelector("#forward1sButton");
        const forward5sButton = floatingControls.querySelector("#forward5sButton");
        const pausePlayButton = floatingControls.querySelector("#pausePlayButton");
        const toggleControlsButton = floatingControls.querySelector("#toggleControlsButton");
        const toggleTranslationButton = document.getElementById("toggleTranslationButton");
        const tuaButtons = floatingControls.querySelector(".tua-buttons");

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay(displayElement) {
            displayElement.textContent = formatTime(audioPlayer.currentTime);
        }

        let customLoopStart = null;
        let customLoopEnd = null;
        let clickCount = 0;
        let isLooping = false;

        const updateInterval = setInterval(() => updateTimeDisplay(timeDisplay), 1000);

        audioPlayer.ontimeupdate = function() {
            updateTimeDisplay(timeDisplay);
            if (isLooping && customLoopStart !== null && customLoopEnd !== null) {
                if (audioPlayer.currentTime >= customLoopEnd) {
                    audioPlayer.currentTime = customLoopStart;
                }
            }
        };

        timeDisplay.onclick = () => {
            if (audioPlayer.paused) {
                clickCount++;
                if (clickCount === 1) {
                    customLoopStart = audioPlayer.currentTime;
                    loopStart.textContent = formatTime(customLoopStart);
                } else if (clickCount === 2) {
                    customLoopEnd = audioPlayer.currentTime;
                    if (customLoopEnd <= customLoopStart) {
                        customLoopEnd = null;
                        loopEnd.textContent = "--:--";
                    } else {
                        loopEnd.textContent = formatTime(customLoopEnd);
                    }
                    clickCount = 0;
                }
            }
        };

        rewind5sButton.onclick = () => {
            if (!isLooping) {
                audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 5);
                updateTimeDisplay(timeDisplay);
            }
        };
        rewind1sButton.onclick = () => {
            if (!isLooping) {
                audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 1);
                updateTimeDisplay(timeDisplay);
            }
        };
        forward1sButton.onclick = () => {
            if (!isLooping) {
                audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 1);
                updateTimeDisplay(timeDisplay);
            }
        };
        forward5sButton.onclick = () => {
            if (!isLooping) {
                audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 5);
                updateTimeDisplay(timeDisplay);
            }
        };

        pausePlayButton.onclick = () => {
            if (audioPlayer.paused) {
                audioPlayer.play();
                pausePlayButton.textContent = "停";
            } else {
                audioPlayer.pause();
                pausePlayButton.textContent = "播";
            }
        };

        loopButton.onclick = () => {
            if (customLoopStart !== null && customLoopEnd !== null) {
                audioPlayer.currentTime = customLoopStart;
                audioPlayer.play();
                isLooping = true;
                rewind5sButton.disabled = true;
                rewind1sButton.disabled = true;
                forward1sButton.disabled = true;
                forward5sButton.disabled = true;
            }
        };

        clearButton.onclick = () => {
            customLoopStart = null;
            customLoopEnd = null;
            loopStart.textContent = "--:--";
            loopEnd.textContent = "--:--";
            clickCount = 0;
            isLooping = false;
            rewind5sButton.disabled = false;
            rewind1sButton.disabled = false;
            forward1sButton.disabled = false;
            forward5sButton.disabled = false;
        };

        let controlsVisible = true;
        toggleControlsButton.onclick = () => {
            if (controlsVisible) {
                timeDisplay.style.display = "none";
                tuaButtons.style.display = "none";
                pausePlayButton.style.display = "none";
                loopStart.style.display = "none";
                loopEnd.style.display = "none";
                loopButton.style.display = "none";
                clearButton.style.display = "none";
                toggleControlsButton.textContent = "示";
                controlsVisible = false;
            } else {
                timeDisplay.style.display = "inline-block";
                tuaButtons.style.display = "flex";
                pausePlayButton.style.display = "inline-flex";
                loopStart.style.display = "inline-block";
                loopEnd.style.display = "inline-block";
                loopButton.style.display = "inline-flex";
                clearButton.style.display = "inline-flex";
                toggleControlsButton.textContent = "藏";
                controlsVisible = true;
            }
        };

        toggleTranslationButton.onclick = () => {
            showTranslation = !showTranslation;
            toggleTranslationButton.textContent = showTranslation ? "藏" : "示";
            renderText();
        };

        audioPlayer.onpause = audioPlayer.onended = function() {
            pausePlayButton.textContent = "播";
        };

        // Biến lưu trữ vị trí cuộn và lựa chọn
        let contentScrollPosition = 0;
        let quizScrollPosition = 0;
        let userSelections = {};
        let isSubmitted = false;

        // Hiển thị câu hỏi và khôi phục lựa chọn
        function loadQuiz() {
            const questionsDiv = document.getElementById('questions');
            questionsDiv.innerHTML = '';
            quizData.forEach((item, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                
                const questionTitle = document.createElement('h3');
                questionTitle.textContent = `Câu ${index + 1}: ${item.question}`;
                questionDiv.appendChild(questionTitle);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options';
                
                item.options.forEach(option => {
                    const label = document.createElement('label');
                    const isChecked = userSelections[`question${index}`] === option ? 'checked' : '';
                    label.innerHTML = `
                        <input type="radio" name="question${index}" value="${option}" ${isChecked}>
                        ${option}
                    `;
                    optionsDiv.appendChild(label);
                });

                questionDiv.appendChild(optionsDiv);
                questionsDiv.appendChild(questionDiv);
            });

            // Khôi phục vị trí cuộn
            window.scrollTo(0, quizScrollPosition);
        }

        // Lưu lựa chọn của người dùng
        function saveSelections() {
            quizData.forEach((_, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    userSelections[`question${index}`] = selected.value;
                }
            });
        }

        // Kiểm tra đáp án
        function checkAnswers() {
            let score = 0;
            const total = quizData.length;
            let wrongAnswers = [];
            
            quizData.forEach((item, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    if (selected.value === item.correct) {
                        score++;
                    } else {
                        wrongAnswers.push({
                            question: item.question,
                            selected: selected.value,
                            correct: item.correct
                        });
                    }
                } else {
                    wrongAnswers.push({
                        question: item.question,
                        selected: "未选择",
                        correct: item.correct
                    });
                }
            });

            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>YD-Visa-结果: ${score}/${total} 答案正确</h3>
                <p>比例: ${(score/total * 100).toFixed(2)}%</p>
            `;

            if (wrongAnswers.length > 0) {
                resultDiv.innerHTML += '<h4>错误答案:</h4>';
                wrongAnswers.forEach((wrong, index) => {
                    resultDiv.innerHTML += `
                        <div class="wrong-answer">
                            Câu ${quizData.findIndex(q => q.question === wrong.question) + 1}: ${wrong.question}<br>
                            你的选择: ${wrong.selected} - 正确答案: ${wrong.correct}
                        </div>
                    `;
                });
            } else {
                resultDiv.innerHTML += '<p>回答正确所有问题</p>';
            }

            resultDiv.scrollIntoView({ behavior: 'smooth' });
            isSubmitted = true; // Đánh dấu đã nộp bài
        }

        // Xử lý chế độ hiển thị
        const contentModeButton = document.getElementById('contentMode');
        const quizModeButton = document.getElementById('quizMode');
        const contentContainer = document.getElementById('contentContainer');
        const quizContainer = document.getElementById('quizContainer');

        contentModeButton.addEventListener('click', () => {
            // Lưu vị trí cuộn của quiz trước khi chuyển
            quizScrollPosition = window.scrollY;
            saveSelections(); // Lưu lựa chọn của người dùng
            
            contentContainer.style.display = 'block';
            quizContainer.style.display = 'none';
            contentModeButton.classList.add('active');
            quizModeButton.classList.remove('active');
            floatingControls.style.display = 'block';
            toggleTranslationButton.style.display = 'inline-block'; // Show translation button
            renderText();
            renderImage();
            
            // Khôi phục vị trí cuộn của content
            window.scrollTo(0, contentScrollPosition);
        });

        quizModeButton.addEventListener('click', () => {
            // Lưu vị trí cuộn của content trước khi chuyển
            contentScrollPosition = window.scrollY;
            saveSelections(); // Lưu lựa chọn của người dùng
            
            contentContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            quizModeButton.classList.add('active');
            contentModeButton.classList.remove('active');
            floatingControls.style.display = 'none';
            toggleTranslationButton.style.display = 'none'; // Hide translation button
            
            // Reset lựa chọn nếu đã nộp bài
            if (isSubmitted) {
                userSelections = {};
                isSubmitted = false;
            }
            
            loadQuiz();
        });

        // Mặc định hiển thị nội dung
        contentContainer.style.display = 'block';
        quizContainer.style.display = 'none';
        toggleTranslationButton.style.display = 'inline-block'; // Show translation button initially
    </script>
</body>
</html>
